{
  "queries":[
  <% node["bcpc"]["hadoop"]["graphite"]["queries"].each_with_index do |(host, queries),hidx| %>
    <% queries.each_with_index do |(key, attrs),qidx| %>
      <% if attrs['type'] == 'jmx' %>
        {"graphite_url": "https://<%=node[:bcpc][:management][:vip]%>:<%=node[:bcpc][:graphite][:web_port]%>/render/?from=-2min&target=<%=attrs['type']%>.<%=host%>.*.<%=attrs['query']%>&format=json",
      <% elsif attrs['type'] == 'function' # graphtie functions eg: asPercent(series1, series2)  %>
        {"graphite_url": "https://<%=node[:bcpc][:management][:vip]%>:<%=node[:bcpc][:graphite][:web_port]%>/render/?from=-2min&target=<%=attrs['query']%>&format=json",
      <% else %>
        {"graphite_url": "https://<%=node[:bcpc][:management][:vip]%>:<%=node[:bcpc][:graphite][:web_port]%>/render/?from=-2min&target=<%=attrs['type']%>.<%=host%>.<%=attrs['query']%>&format=json",
      <% end %>
        "zabbix_host" : "<%=host%>",
      <% if hidx == node[:bcpc][:hadoop][:graphite][:queries].length-1 and qidx == queries.length()-1 %>
        "zabbix_key" : "<%=key%>"}
      <% else %>
        "zabbix_key" : "<%=key%>"},
      <% end %>
    <% end #queries.each %>
  <% end #node[..].each %>
  ]
}
